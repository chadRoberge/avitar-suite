{{page-title "Property Permits"}}

<div class="avitar-page-header">
  <div class="avitar-page-header__content">
    <h1 class="avitar-page-header__title">
      <i class="fas fa-file-alt avitar-mr-2"></i>
      Property Permits
    </h1>
    <p class="avitar-page-header__subtitle">
      {{@model.property.location.address}} (PID: {{@model.property.pid_formatted}})
    </p>
  </div>

  <div class="avitar-page-header__actions">
    <button
      type="button"
      class="avitar-btn avitar-btn--primary"
      {{on "click" (fn (transition-to "municipality.building-permits.create"))}}
    >
      <i class="fas fa-plus avitar-mr-2"></i>
      New Permit
    </button>
  </div>
</div>

{{#if @model.permits.length}}
  <div class="avitar-card">
    <div class="avitar-card__header">
      <h3 class="avitar-card__title">Permits for this Property</h3>
    </div>

    <div class="avitar-card__body avitar-p-0">
      <table class="avitar-table">
        <thead>
          <tr>
            <th>Permit #</th>
            <th>Type</th>
            <th>Description</th>
            <th>Status</th>
            <th>Application Date</th>
            <th>Value</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each @model.permits as |permit|}}
            <tr>
              <td>
                <LinkTo @route="municipality.building-permits.permit" @model={{permit._id}} class="avitar-link">
                  {{permit.permitNumber}}
                </LinkTo>
              </td>
              <td>{{permit.type}}</td>
              <td>{{permit.description}}</td>
              <td>
                <span class="avitar-badge avitar-badge--{{permit.statusClass}}">
                  {{permit.status}}
                </span>
              </td>
              <td>{{format-date permit.applicationDate}}</td>
              <td>${{format-number permit.estimatedValue}}</td>
              <td>
                <LinkTo @route="municipality.building-permits.permit" @model={{permit._id}} class="avitar-btn avitar-btn--sm avitar-btn--secondary">
                  <i class="fas fa-eye"></i>
                </LinkTo>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
  </div>
{{else}}
  <div class="avitar-card">
    <div class="avitar-card__body avitar-text-center avitar-py-8">
      <i class="fas fa-file-alt fa-3x avitar-text-muted avitar-mb-3"></i>
      <h3 class="avitar-mb-2">No Permits Found</h3>
      <p class="avitar-text-muted avitar-mb-4">
        This property doesn't have any permits yet.
      </p>
      <button
        type="button"
        class="avitar-btn avitar-btn--primary"
        {{on "click" (fn (transition-to "municipality.building-permits.create"))}}
      >
        <i class="fas fa-plus avitar-mr-2"></i>
        Create First Permit
      </button>
    </div>
  </div>
{{/if}}
