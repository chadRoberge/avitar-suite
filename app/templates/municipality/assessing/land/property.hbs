{{!-- Land Assessment Property Detail View --}}
<div class="avitar-content">
  {{!-- Property Header with owner, type, location, and total assessment --}}
  <Assessing::PropertyHeader @property={{@model.property}} @landAssessment={{@model.landAssessment}} @onPropertyUpdate={{this.refreshLandProperty}} />
  
  {{!-- Land Assessment Information --}}
  <div class="avitar-card avitar-mb-6">
    <div class="avitar-card__header avitar-card__header--colored">
      <div class="avitar-flex avitar-items-center avitar-justify-between">
        <div>
          <h3 class="avitar-card__title">Land Assessment Details</h3>
          <div class="avitar-card__subtitle">Zoning, valuation, and use information</div>
        </div>
        {{#if (can "update" "assessing")}}
          <button 
            class="avitar-btn avitar-btn--primary avitar-btn--sm"
            {{on "click" this.openLandEditModal}}
            type="button"
          >
            <i class="fas fa-edit avitar-mr-2"></i>Edit
          </button>
        {{/if}}
      </div>
    </div>
    <div class="avitar-card__body">
      {{!-- Row 1: Zone and Market Value --}}
      <div class="avitar-flex avitar-flex-row avitar-mb-4">
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Zone:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{or @model.landAssessment.zone_name 'No Zone'}}</span>
        </div>
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Market Value:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-success">
            ${{number-format @model.landAssessment.market_value}}
          </span>
        </div>
      </div>

      {{!-- Row 2: Neighborhood and Current Use Credit --}}
      <div class="avitar-flex avitar-flex-row avitar-mb-4">
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Neighborhood:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{@model.property.location.neighborhood}}</span>
        </div>
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Current Use Credit:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">
            ${{number-format @model.landAssessment.calculated_totals.totalCurrentUseCredit}}
          </span>
        </div>
      </div>

      {{!-- Row 3: Land Use and Taxable Value --}}
      <div class="avitar-flex avitar-flex-row avitar-mb-4">
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Land Use:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{@model.landAssessment.land_use}}</span>
        </div>
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Taxable Value:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">
            ${{number-format @model.landAssessment.taxable_value}}
          </span>
        </div>
      </div>

      {{!-- Row 4: Site, Driveway, and Road --}}
      <div class="avitar-flex avitar-flex-row">
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Site:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{@model.landAssessment.site_conditions_name}}</span>
        </div>
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Driveway:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{@model.landAssessment.driveway_type_name}}</span>
        </div>
        <div class="avitar-flex-3 avitar-text-right">
          <span class="avitar-text-sm avitar-text-muted avitar-font-bold">Road:</span>
        </div>
        <div class="avitar-flex-3 avitar-ml-3">
          <span class="avitar-text-sm avitar-font-bold avitar-text-primary">{{@model.landAssessment.road_type_name}}</span>
        </div>
      </div>
    </div>
  </div>

  {{!-- Land Use Details Table --}}
  <div class="avitar-card">
    <div class="avitar-card__header avitar-card__header--colored">
      <h3 class="avitar-card__title">Land Use Breakdown</h3>
      <div class="avitar-card__subtitle">Detailed assessment by land use category</div>
    </div>
    <div class="avitar-card__body avitar-p-0">
      {{#if @model.landAssessment.land_use_details}}
        {{!-- Flexbox Table Header --}}
        <div class="avitar-flex-table-header">
          <div class="avitar-flex-table-cell avitar-flex-3">LND USE</div>
          <div class="avitar-flex-table-cell avitar-flex-2">SIZE</div>
          <div class="avitar-flex-table-cell avitar-flex-1">TOPO</div>
          <div class="avitar-flex-table-cell avitar-flex-1">COND</div>
          <div class="avitar-flex-table-cell avitar-flex-1">SPI</div>
          <div class="avitar-flex-table-cell avitar-flex-3">AD VOLOREM</div>
          <div class="avitar-flex-table-cell avitar-flex-2">CU</div>
          <div class="avitar-flex-table-cell avitar-flex-2">ASSESSED</div>
          <div class="avitar-flex-table-cell avitar-flex-4">NOTES</div>
        </div>

        {{!-- Land Use Details --}}
        <div class="avitar-flex-table-body">
          {{#each @model.landAssessment.land_use_details as |detail|}}
            <div class="avitar-flex-table-row">
              {{!-- Land Use Type --}}
              <div class="avitar-flex-table-cell avitar-flex-3">
                {{detail.land_use_type}}
              </div>

              {{!-- Size with Units --}}
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-flex avitar-justify-end">
                {{detail.size}} {{detail.size_unit}}
              </div>

              {{!-- Topography --}}
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{detail.topography}}
              </div>

              {{!-- Condition --}}
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{detail.condition}}
              </div>

              {{!-- SPI --}}
              <div class="avitar-flex-table-cell avitar-flex-1 avitar-flex avitar-justify-end">
                {{detail.spi}}
              </div>

              {{!-- Market Value --}}
              <div class="avitar-flex-table-cell avitar-flex-3 avitar-flex avitar-justify-end">
                ${{number-format detail.marketValue}}
              </div>

              {{!-- Current Use Value --}}
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-flex avitar-justify-end">
                ${{number-format detail.currentUseValue}}
              </div>

              {{!-- Assessed Value --}}
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-flex avitar-justify-end">
                ${{number-format detail.assessedValue}}
              </div>

              {{!-- Notes --}}
              <div class="avitar-flex-table-cell avitar-flex-4">
                {{detail.notes}}
              </div>
            </div>
          {{/each}}
        </div>

        {{!-- Calculated Totals Section - Aligned with columns --}}
        {{#if @model.landAssessment.calculated_totals}}
          <div class="avitar-border-t avitar-bg-gray-50">
            <div class="avitar-flex-table-row avitar-font-bold avitar-py-4">
              <div class="avitar-flex-table-cell avitar-flex-3 avitar-text-right avitar-text-muted">
                Total Acreage:
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-font-semibold avitar-text-primary avitar-flex avitar-justify-end">
                {{number-format @model.landAssessment.calculated_totals.totalAcreage 2}} AC
              </div>
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{!-- Topography column - empty --}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{!-- Condition column - empty --}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-1 avitar-text-right avitar-text-muted">
                Total Market:
              </div>
              <div class="avitar-flex-table-cell avitar-flex-3 avitar-font-semibold avitar-text-success avitar-flex avitar-justify-end">
                ${{number-format @model.landAssessment.calculated_totals.landDetailsMarketValue}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-font-semibold avitar-text-secondary avitar-flex avitar-justify-end">
                ${{number-format @model.landAssessment.calculated_totals.totalCurrentUseValue}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2 avitar-font-semibold avitar-text-info avitar-flex avitar-justify-end">
                ${{number-format @model.landAssessment.calculated_totals.landDetailsAssessedValue}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-4">
                {{!-- Notes column - empty --}}
              </div>
            </div>
          </div>
        {{/if}}

      {{else}}
        <div class="avitar-text-center avitar-text-muted avitar-py-8">
          <div>No land use details available for this property</div>
          <div class="avitar-text-sm avitar-mt-2">Land use breakdown will appear here when available</div>
        </div>
      {{/if}}
    </div>
  </div>

  {{!-- View Assessment Card --}}
  <div class="avitar-card avitar-mb-6">
    <div class="avitar-card__header avitar-card__header--colored">
      <div class="avitar-flex avitar-items-center avitar-justify-between">
        <div>
          <h3 class="avitar-card__title">View Assessment</h3>
          <div class="avitar-card__subtitle">Property views and visual enhancements</div>
        </div>
        {{#if (can "update" "assessing")}}
          <button
            class="avitar-btn avitar-btn--primary avitar-btn--sm"
            {{on "click" this.openViewEditModal}}
            type="button"
          >
            <i class="fas fa-plus avitar-mr-2"></i>Add View
          </button>
        {{/if}}
      </div>
    </div>
    <div class="avitar-card__body avitar-p-0">
      {{#if @model.views}}
        {{!-- Views Table Header --}}
        <div class="avitar-flex-table-header">
          <div class="avitar-flex-table-cell avitar-flex-3">SUBJECT</div>
          <div class="avitar-flex-table-cell avitar-flex-2">WIDTH</div>
          <div class="avitar-flex-table-cell avitar-flex-2">DISTANCE</div>
          <div class="avitar-flex-table-cell avitar-flex-2">DEPTH</div>
          <div class="avitar-flex-table-cell avitar-flex-2">BASE VALUE</div>
          <div class="avitar-flex-table-cell avitar-flex-3">CALCULATED VALUE</div>
          <div class="avitar-flex-table-cell avitar-flex-1">ACTIONS</div>
        </div>

        {{!-- Views Table Body --}}
        <div class="avitar-flex-table-body">
          {{#each @model.views as |view|}}
            <div class="avitar-flex-table-row">
              <div class="avitar-flex-table-cell avitar-flex-3">
                {{view.subjectName}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{view.widthName}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{view.distanceName}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{view.depthName}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                ${{number-format view.baseValue}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-3">
                ${{number-format view.calculatedValue}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{#if (can "update" "assessing")}}
                  <button
                    class="avitar-btn avitar-btn--primary avitar-btn--xs"
                    {{on "click" (fn this.editView view)}}
                    type="button"
                    title="Edit View"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="avitar-btn avitar-btn--danger avitar-btn--xs avitar-ml-1"
                    {{on "click" (fn this.deleteView view)}}
                    type="button"
                    title="Delete View"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                {{/if}}
              </div>
            </div>
          {{/each}}

          {{!-- View Totals Row --}}
          <div class="avitar-flex-table-row avitar-font-bold avitar-py-4 avitar-bg-gray-50">
            <div class="avitar-flex-table-cell avitar-flex-3 avitar-text-right avitar-text-muted">
              Total View Value:
            </div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-3 avitar-font-semibold avitar-text-success avitar-flex avitar-justify-end">
              ${{number-format @model.landAssessment.calculated_totals.totalViewValue}}
            </div>
            <div class="avitar-flex-table-cell avitar-flex-1"></div>
          </div>
        </div>
      {{else}}
        <div class="avitar-text-center avitar-text-muted avitar-py-8">
          <div>No views added for this property</div>
          <div class="avitar-text-sm avitar-mt-2">Click "Add View" to add property views and enhance land value</div>
        </div>
      {{/if}}
    </div>
  </div>

  {{!-- Waterfront Assessment Card --}}
  <div class="avitar-card avitar-mb-6">
    <div class="avitar-card__header avitar-card__header--colored">
      <div class="avitar-flex avitar-items-center avitar-justify-between">
        <div>
          <h3 class="avitar-card__title">Waterfront Assessment</h3>
          <div class="avitar-card__subtitle">Water frontage and access values</div>
        </div>
        {{#if (can "update" "assessing")}}
          <button
            class="avitar-btn avitar-btn--primary avitar-btn--sm"
            {{on "click" this.openWaterfrontEditModal}}
            type="button"
          >
            <i class="fas fa-plus avitar-mr-2"></i>Add Waterfront
          </button>
        {{/if}}
      </div>
    </div>
    <div class="avitar-card__body avitar-p-0">
      {{#if @model.landAssessment.waterfront}}
        {{!-- Waterfront Table Header --}}
        <div class="avitar-flex-table-header">
          <div class="avitar-flex-table-cell avitar-flex-3">WATER BODY</div>
          <div class="avitar-flex-table-cell avitar-flex-2">FRONTAGE</div>
          <div class="avitar-flex-table-cell avitar-flex-2">ACCESS</div>
          <div class="avitar-flex-table-cell avitar-flex-2">TOPOGRAPHY</div>
          <div class="avitar-flex-table-cell avitar-flex-2">LOCATION</div>
          <div class="avitar-flex-table-cell avitar-flex-2">BASE VALUE</div>
          <div class="avitar-flex-table-cell avitar-flex-3">CALCULATED VALUE</div>
          <div class="avitar-flex-table-cell avitar-flex-1">ACTIONS</div>
        </div>

        {{!-- Waterfront Table Body --}}
        <div class="avitar-flex-table-body">
          {{#each @model.landAssessment.waterfront as |waterfront|}}
            <div class="avitar-flex-table-row">
              <div class="avitar-flex-table-cell avitar-flex-3">
                {{waterfront.water_body_name}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{waterfront.frontage}} ft
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{waterfront.access}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{waterfront.topography}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                {{waterfront.location}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-2">
                ${{number-format waterfront.base_value}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-3">
                ${{number-format waterfront.calculated_value}}
              </div>
              <div class="avitar-flex-table-cell avitar-flex-1">
                {{#if (can "update" "assessing")}}
                  <button
                    class="avitar-btn avitar-btn--ghost avitar-btn--xs"
                    {{on "click" (fn this.editWaterfront waterfront)}}
                    type="button"
                    title="Edit Waterfront"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="avitar-btn avitar-btn--danger avitar-btn--xs avitar-ml-1"
                    {{on "click" (fn this.deleteWaterfront waterfront)}}
                    type="button"
                    title="Delete Waterfront"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                {{/if}}
              </div>
            </div>
          {{/each}}

          {{!-- Waterfront Totals Row --}}
          <div class="avitar-flex-table-row avitar-font-bold avitar-py-4 avitar-bg-gray-50">
            <div class="avitar-flex-table-cell avitar-flex-3 avitar-text-right avitar-text-muted">
              Total Waterfront Value:
            </div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-2"></div>
            <div class="avitar-flex-table-cell avitar-flex-3 avitar-font-semibold avitar-text-success avitar-flex avitar-justify-end">
              ${{number-format @model.landAssessment.calculated_totals.totalWaterfrontValue}}
            </div>
            <div class="avitar-flex-table-cell avitar-flex-1"></div>
          </div>
        </div>
      {{else}}
        <div class="avitar-text-center avitar-text-muted avitar-py-8">
          <div>No waterfront added for this property</div>
          <div class="avitar-text-sm avitar-mt-2">Click "Add Waterfront" to add water access and enhance land value</div>
        </div>
      {{/if}}
    </div>
  </div>
</div>

{{!-- Land Edit Modal --}}
<Assessing::LandEditModal
  @isOpen={{this.showLandEditModal}}
  @property={{@model.property}}
  @landAssessment={{@model.landAssessment}}
  @views={{@model.views}}
  @onSave={{this.refreshLandProperty}}
  @onClose={{this.closeLandEditModal}}
/>

{{!-- View Edit Modal --}}
<Assessing::ViewEditModal
  @isOpen={{this.showViewEditModal}}
  @property={{@model.property}}
  @landAssessment={{@model.landAssessment}}
  @view={{this.selectedView}}
  @viewAttributes={{this.viewAttributes}}
  @zoneBaseViewValues={{this.zoneBaseViewValues}}
  @onSave={{this.saveView}}
  @onClose={{this.closeViewEditModal}}
/>

{{!-- Waterfront Edit Modal --}}
<Assessing::WaterfrontEditModal
  @isOpen={{this.showWaterfrontEditModal}}
  @property={{@model.property}}
  @waterfront={{this.selectedWaterfront}}
  @waterBodies={{this.waterBodies}}
  @onSave={{this.saveWaterfront}}
  @onClose={{this.closeWaterfrontEditModal}}
/>