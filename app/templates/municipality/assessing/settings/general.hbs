{{!-- General Assessing Settings --}}
<div class="avitar-content">
  <div class="avitar-page-header">
    <h1 class="avitar-page-title">General Settings</h1>
    <div class="avitar-page-subtitle">Configure general assessing parameters</div>
  </div>

  {{!-- Assessment Years Management Section --}}
  <div class="avitar-card avitar-mb-6">
    <div class="avitar-card__header">
      <h3 class="avitar-card__title">{{{lnr-icon "calendar-full" class="avitar-mr-2"}}}Assessment Years</h3>
      <div class="avitar-card__subtitle">Manage assessment years and visibility</div>
    </div>

    <div class="avitar-card__body">
      {{#if this.isLoadingYears}}
        <div class="avitar-flex avitar-items-center avitar-justify-center avitar-py-8">
          {{{lnr-icon "sync" class="avitar-spin avitar-text-2xl avitar-text-muted"}}}
          <span class="avitar-ml-2 avitar-text-muted">Loading years...</span>
        </div>
      {{else}}
        {{!-- Create New Year Form --}}
        <div class="avitar-bg-gray-50 avitar-p-4 avitar-rounded avitar-mb-6">
          <h4 class="avitar-font-semibold avitar-mb-3">{{{lnr-icon "plus-circle" class="avitar-mr-2"}}}Create New Assessment Year</h4>
          <div class="avitar-flex avitar-gap-4 avitar-items-end">
            <div class="avitar-form-group avitar-mb-0">
              <label class="avitar-label">Copy From Year</label>
              <select class="avitar-select" {{on "change" this.updateSourceYear}}>
                {{#each this.yearManagementData.years as |yearInfo|}}
                  <option value={{yearInfo.year}} selected={{eq yearInfo.year this.effectiveSourceYear}}>
                    {{yearInfo.year}} ({{yearInfo.propertyCount}} properties)
                  </option>
                {{/each}}
              </select>
            </div>
            <div class="avitar-form-group avitar-mb-0">
              <label class="avitar-label">New Year</label>
              <input
                type="number"
                class="avitar-input"
                value={{this.effectiveTargetYear}}
                min="2000"
                max="2099"
                {{on "input" this.updateTargetYear}}
              >
            </div>
            <button
              type="button"
              class="avitar-btn avitar-btn--primary"
              {{on "click" this.createNewYear}}
              disabled={{this.isCreatingYear}}
            >
              {{#if this.isCreatingYear}}
                {{{lnr-icon "sync" class="avitar-spin avitar-mr-2"}}}
                Creating...
              {{else}}
                {{{lnr-icon "plus-circle" class="avitar-mr-2"}}}
                Create Year
              {{/if}}
            </button>
          </div>
          <p class="avitar-text-sm avitar-text-muted avitar-mt-2">
            New years are hidden by default so you can work on revaluations before publishing.
          </p>
        </div>

        {{!-- Available Years Table --}}
        <h4 class="avitar-font-semibold avitar-mb-3">Available Assessment Years</h4>
        {{#if this.yearManagementData.years.length}}
          <table class="avitar-table avitar-table--hover">
            <thead>
              <tr>
                <th>Year</th>
                <th>Properties</th>
                <th>Visibility</th>
                <th class="avitar-text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              {{#each this.yearManagementData.years as |yearInfo|}}
                <tr>
                  <td>
                    <span class="avitar-font-semibold">{{yearInfo.year}}</span>
                    {{#if (eq yearInfo.year this.yearManagementData.currentTaxYear)}}
                      <span class="avitar-badge avitar-badge--primary avitar-badge--sm avitar-ml-2">Current</span>
                    {{/if}}
                  </td>
                  <td>{{yearInfo.propertyCount}} properties</td>
                  <td>
                    {{#if yearInfo.isHidden}}
                      <span class="avitar-badge avitar-badge--warning">
                        {{{lnr-icon "lock" class="avitar-mr-1"}}}Hidden
                      </span>
                    {{else}}
                      <span class="avitar-badge avitar-badge--success">
                        {{{lnr-icon "eye" class="avitar-mr-1"}}}Public
                      </span>
                    {{/if}}
                  </td>
                  <td class="avitar-text-right">
                    <button
                      type="button"
                      class="avitar-btn avitar-btn--sm {{if yearInfo.isHidden 'avitar-btn--success' 'avitar-btn--warning'}}"
                      {{on "click" (fn this.toggleYearVisibility yearInfo.year (not yearInfo.isHidden))}}
                      disabled={{this.isTogglingYear}}
                    >
                      {{#if yearInfo.isHidden}}
                        {{{lnr-icon "eye" class="avitar-mr-1"}}}
                        Show to Public
                      {{else}}
                        {{{lnr-icon "lock" class="avitar-mr-1"}}}
                        Hide from Public
                      {{/if}}
                    </button>
                  </td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        {{else}}
          <div class="avitar-empty-state avitar-py-8">
            {{{lnr-icon "calendar-full" class="avitar-text-3xl avitar-text-muted avitar-mb-4"}}}
            <h3 class="avitar-text-lg avitar-font-semibold">No Assessment Years</h3>
            <p class="avitar-text-muted">Create your first assessment year to get started.</p>
          </div>
        {{/if}}
      {{/if}}
    </div>
  </div>

  <div class="avitar-card">
    <div class="avitar-card__header">
      <h3 class="avitar-card__title">Assessment Configuration</h3>
      <div class="avitar-card__subtitle">Basic settings for property assessments</div>
    </div>
    
    <div class="avitar-card__body">
      <form>
        <div class="avitar-form-grid avitar-form-grid--2-col">
          <div class="avitar-form-group">
            <label class="avitar-label">Assessment Year</label>
            <input 
              type="number" 
              class="avitar-input" 
              value={{@model.generalSettings.assessmentYear}}
              min="2000"
              max="2099"
            >
            <div class="avitar-help-text">The current assessment year for property valuations</div>
          </div>

          <div class="avitar-form-group">
            <label class="avitar-label">Property Tax Rate (%)</label>
            <input 
              type="number" 
              class="avitar-input" 
              value={{@model.generalSettings.propertyTaxRate}}
              step="0.01"
              min="0"
            >
            <div class="avitar-help-text">Tax rate as a percentage of assessed value</div>
          </div>

          <div class="avitar-form-group">
            <label class="avitar-label">Assessment Ratio (%)</label>
            <input 
              type="number" 
              class="avitar-input" 
              value={{@model.generalSettings.assessmentRatio}}
              min="1"
              max="100"
            >
            <div class="avitar-help-text">Percentage of market value used for assessment</div>
          </div>

          <div class="avitar-form-group">
            <label class="avitar-label">Exemption Threshold ($)</label>
            <input 
              type="number" 
              class="avitar-input" 
              value={{@model.generalSettings.exemptionThreshold}}
              min="0"
              step="100"
            >
            <div class="avitar-help-text">Minimum assessed value for taxation</div>
          </div>
        </div>

        <div class="avitar-form-section">
          <h4 class="avitar-form-section-title">Module Settings</h4>
          
          <div class="avitar-form-group">
            <label class="avitar-checkbox">
              <input 
                type="checkbox" 
                checked={{@model.generalSettings.enableSketch}}
              >
              <span class="avitar-checkbox__checkmark"></span>
              <span class="avitar-checkbox__label">Enable Sketch Module</span>
            </label>
            <div class="avitar-help-text">Allow users to create building sketches</div>
          </div>

          <div class="avitar-form-group">
            <label class="avitar-checkbox">
              <input 
                type="checkbox" 
                checked={{@model.generalSettings.enableAIReview}}
              >
              <span class="avitar-checkbox__checkmark"></span>
              <span class="avitar-checkbox__label">Enable AI Review (Enterprise)</span>
            </label>
            <div class="avitar-help-text">Use AI to review and validate assessments</div>
          </div>
        </div>

        <div class="avitar-form-group">
          <label class="avitar-label">Default Building Type</label>
          <select class="avitar-select">
            <option value="residential" selected={{eq @model.generalSettings.defaultBuildingType "residential"}}>Residential</option>
            <option value="commercial" selected={{eq @model.generalSettings.defaultBuildingType "commercial"}}>Commercial</option>
            <option value="industrial" selected={{eq @model.generalSettings.defaultBuildingType "industrial"}}>Industrial</option>
            <option value="mixed-use" selected={{eq @model.generalSettings.defaultBuildingType "mixed-use"}}>Mixed Use</option>
          </select>
          <div class="avitar-help-text">Default building type for new properties</div>
        </div>

        <div class="avitar-form-section">
          <h4 class="avitar-form-section-title">State Reporting</h4>
          
          <div class="avitar-form-grid avitar-form-grid--2-col">
            <div class="avitar-form-group">
              <label class="avitar-label">State ID</label>
              <input 
                type="text" 
                class="avitar-input" 
                value={{@model.generalSettings.stateId}}
                placeholder="Enter state identifier"
              >
              <div class="avitar-help-text">State identifier for matching exemptions and reports</div>
            </div>

            <div class="avitar-form-group">
              <label class="avitar-label">State Reporting URL</label>
              <input 
                type="url" 
                class="avitar-input" 
                value={{@model.generalSettings.stateUrl}}
                placeholder="https://state-reporting-system.gov/api"
              >
              <div class="avitar-help-text">URL endpoint for sending reports to the state</div>
            </div>
          </div>
        </div>

        <div class="avitar-form-actions">
          <button type="submit" class="avitar-btn avitar-btn--primary">
            {{{lnr-icon "checkmark-circle" class="avitar-mr-2"}}}
            Save Settings
          </button>
          <button type="button" class="avitar-btn avitar-btn--secondary">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>