{{!-- Feature Details Settings --}}
<div class="avitar-content">
  <div class="avitar-page-header avitar-mb-2">
    <div class="avitar-flex avitar-justify-between avitar-items-center">
      <div>
        <h1 class="avitar-page-title avitar-skinny">Feature Details</h1>
        <div class="avitar-page-subtitle">Configure property feature codes</div>
      </div>
      {{!-- Year Selector --}}
      <div class="avitar-flex avitar-items-center avitar-gap-2">
        <label class="avitar-text-sm avitar-font-medium">Config Year:</label>
        <select class="avitar-select avitar-select--sm" style="width: 100px;" {{on "change" this.changeYear}}>
          {{#each this.availableYears as |yearOption|}}
            <option value={{yearOption}} selected={{eq this.configYear yearOption}}>
              {{yearOption}}
            </option>
          {{/each}}
        </select>
        {{#if this.isYearLocked}}
          <span class="avitar-badge avitar-badge--warning avitar-ml-2">
            {{lnr-icon "lock" class="avitar-mr-1"}}
            Locked
          </span>
        {{/if}}
      </div>
    </div>
  </div>

  {{!-- Year Locked Warning Banner --}}
  {{#if this.isYearLocked}}
    <div class="avitar-alert avitar-alert--warning avitar-mb-4">
      <div class="avitar-flex avitar-items-center avitar-gap-3">
        {{lnr-icon "lock" class="avitar-text-lg"}}
        <div>
          <strong>Configuration Locked</strong>
          <p class="avitar-text-sm avitar-mb-0">
            The configuration for year {{this.configYear}} is locked and cannot be modified.
            Select a different year to make changes.
          </p>
        </div>
      </div>
    </div>
  {{/if}}

  <div class="avitar-card">
    <div class="avitar-card__header avitar-card__header--colored">
      <div class="avitar-flex avitar-justify-between avitar-items-center">
        <div>
          <h3 class="avitar-card__title">Feature Codes</h3>
          <div class="avitar-card__subtitle">Codes with descriptions, rates, size adjustments, and measurement types</div>
        </div>
        {{#unless (or this.isAddingFeatureCode this.isEditingFeatureCode)}}
          <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.startAddingFeatureCode}} disabled={{this.isYearLocked}}>
            {{lnr-icon "plus-circle" class="avitar-mr-2"}}
            Add Feature Code
          </button>
        {{/unless}}
      </div>
    </div>
    <div class="avitar-card__body">
      {{#if (or this.isAddingFeatureCode this.isEditingFeatureCode)}}
        <div class="avitar-bg-gray-50 avitar-p-4 avitar-rounded avitar-mb-4">
          <h4 class="avitar-font-semibold avitar-mb-3">{{if this.isEditingFeatureCode "Edit Feature Code" "Add New Feature Code"}}</h4>
          
          <div class="avitar-grid avitar-grid-cols-1 md:avitar-grid-cols-2 avitar-gap-4">
            <div class="avitar-form-group">
              <label class="avitar-label">Code</label>
              <input type="text" class="avitar-input" value={{this.newFeatureCode}} {{on "input" this.updateFeatureCode}} placeholder="e.g., POOL" maxlength="10" />
            </div>
            <div class="avitar-form-group">
              <label class="avitar-label">Description</label>
              <input type="text" class="avitar-input" value={{this.newFeatureDescription}} {{on "input" this.updateFeatureDescription}} placeholder="e.g., Swimming Pool" />
            </div>
          </div>

          <div class="avitar-grid avitar-grid-cols-1 md:avitar-grid-cols-3 avitar-gap-4 avitar-mt-4">
            <div class="avitar-form-group">
              <label class="avitar-label">Rate</label>
              <input type="number" class="avitar-input" value={{this.newFeatureRate}} {{on "input" this.updateFeatureRate}} step="0.01" min="0" placeholder="e.g., 15000" />
            </div>
            <div class="avitar-form-group">
              <label class="avitar-label">Size Adjustment</label>
              <select class="avitar-select" value={{this.newSizeAdjustment}} {{on "change" this.updateSizeAdjustment}}>
                <option value="">Select size adjustment...</option>
                <option value="normal">Normal</option>
                <option value="zero">Zero</option>
              </select>
            </div>
            <div class="avitar-form-group">
              <label class="avitar-label">Measurement Type</label>
              <select class="avitar-select" value={{this.newMeasurementType}} {{on "change" this.updateMeasurementType}}>
                <option value="">Select measurement type...</option>
                <option value="length_width">Length & Width</option>
                <option value="units">Units Only</option>
              </select>
            </div>
          </div>

          <div class="avitar-flex avitar-gap-2 avitar-mt-4">
            <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.saveFeatureCode}}>Save Code</button>
            <button type="button" class="avitar-btn avitar-btn--secondary" {{on "click" (if this.isEditingFeatureCode this.cancelEditingFeatureCode this.cancelAddingFeatureCode)}}>Cancel</button>
          </div>
        </div>
      {{/if}}

      {{#if this.reactiveFeatureCodes.length}}
        <div class="avitar-table-container">
          <table class="avitar-table">
            <thead>
              <tr>
                <th>Code</th>
                <th>Description</th>
                <th>Rate</th>
                <th>Size Adjustment</th>
                <th>Measurement Type</th>
                <th class="avitar-table__actions-col">Actions</th>
              </tr>
            </thead>
            <tbody>
              {{#each this.reactiveFeatureCodes as |code|}}
                <tr>
                  <td>{{code.code}}</td>
                  <td>{{code.description}}</td>
                  <td>{{format-currency code.rate}}</td>
                  <td>{{capitalize code.sizeAdjustment}}</td>
                  <td>{{code.measurementType}}</td>
                  <td class="avitar-table__actions">
                    <button type="button" class="avitar-btn avitar-btn--secondary avitar-btn--xs" {{on "click" (fn this.startEditingFeatureCode code)}} title="Edit">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="avitar-btn avitar-btn--danger avitar-btn--xs" {{on "click" (fn this.deleteFeatureCode code)}} title="Delete">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      {{else}}
        <div class="avitar-empty-state avitar-text-center avitar-py-6">
          <i class="fas fa-puzzle-piece avitar-text-3xl avitar-text-muted avitar-mb-3"></i>
          <div class="avitar-font-semibold avitar-mb-2">No Feature Codes</div>
          <div class="avitar-text-muted avitar-mb-4">Add your first feature code to get started</div>
          <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.startAddingFeatureCode}}>
            <i class="fas fa-plus avitar-mr-2"></i>
            Add First Feature Code
          </button>
        </div>
      {{/if}}
    </div>
  </div>
</div>