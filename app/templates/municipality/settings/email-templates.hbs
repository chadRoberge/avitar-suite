{{page-title "Email Templates - Settings"}}

<div class="avitar-layout">
  {{! Settings Menu Sidebar }}
  <Shared::SettingsMenu />

  {{! Main Content }}
  <main class="avitar-main avitar-main--with-sidebar avitar-main--with-topbar">
    <div class="avitar-container avitar-py-6">
      {{! Header }}
      <div class="avitar-flex avitar-justify-between avitar-items-center avitar-mb-6">
        <div>
          <h2 class="avitar-text-2xl avitar-font-bold avitar-text-gray-900">
            Email Templates
          </h2>
          <p class="avitar-text-sm avitar-text-muted avitar-mt-1">
            Customize notification email templates for your municipality
          </p>
        </div>
      </div>

      {{! Info Banner }}
      <div class="avitar-card avitar-bg-primary-light avitar-border-primary avitar-mb-6">
        <div class="avitar-card__body avitar-p-4">
          <div class="avitar-flex avitar-items-start avitar-gap-3">
            <div class="avitar-flex-shrink-0 avitar-mt-1">
              <i class="fas fa-info-circle avitar-text-primary"></i>
            </div>
            <div>
              <p class="avitar-text-sm">
                <strong>Customize your email notifications:</strong> Each template can be personalized with dynamic variables like property addresses, permit numbers, and dates. Click "Edit" to modify a template or "Preview" to see how it looks.
              </p>
            </div>
          </div>
        </div>
      </div>

      {{! Filters }}
      <div class="avitar-card avitar-mb-6">
        <div class="avitar-card__body avitar-p-4">
          <div class="avitar-flex avitar-gap-3">
            <div class="avitar-flex-1">
              <input
                type="text"
                class="avitar-input"
                placeholder="Search templates..."
                value={{this.searchText}}
                {{on "input" this.updateSearch}}
              />
            </div>
            <div class="avitar-flex-shrink-0" style="min-width: 200px">
              <select class="avitar-select" {{on "change" this.updateFilter}}>
                {{#each this.categories as |category|}}
                  <option value={{category.value}} selected={{eq this.filterCategory category.value}}>
                    {{category.label}}
                  </option>
                {{/each}}
              </select>
            </div>
          </div>
        </div>
      </div>

      {{! Templates List }}
      <div class="avitar-card">
        <div class="avitar-card__header">
          <h3 class="avitar-card__title">
            Available Templates
          </h3>
        </div>

        <div class="avitar-card__body avitar-p-0">
          {{#if this.hasTemplates}}
            <div class="avitar-table-container">
              <table class="avitar-table">
                <thead>
                  <tr>
                    <th>Template Name</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Last Modified</th>
                    <th class="avitar-text-center">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each this.displayedTemplates as |template|}}
                    <tr>
                      <td>
                        <div class="avitar-font-medium">
                          {{template.name}}
                        </div>
                      </td>

                      <td>
                        <span class="avitar-badge avitar-badge--sm avitar-badge--secondary">
                          {{template.category}}
                        </span>
                      </td>

                      <td>
                        <span class="avitar-text-sm avitar-text-muted">
                          {{template.description}}
                        </span>
                      </td>

                      <td>
                        <button
                          type="button"
                          class="avitar-badge avitar-badge--sm
                            {{if template.is_active 'avitar-badge--success' 'avitar-badge--secondary'}}"
                          {{on "click" (fn this.toggleTemplateActive template)}}
                          title="Click to toggle"
                        >
                          {{#if template.is_active}}
                            <i class="fas fa-check-circle avitar-mr-1"></i>
                            Active
                          {{else}}
                            <i class="fas fa-times-circle avitar-mr-1"></i>
                            Inactive
                          {{/if}}
                        </button>
                      </td>

                      <td>
                        <span class="avitar-text-sm avitar-text-muted">
                          {{#if template.updated_at}}
                            {{date-format template.updated_at "MMM DD, YYYY"}}
                          {{else}}
                            Never
                          {{/if}}
                        </span>
                      </td>

                      <td>
                        <div class="avitar-flex avitar-justify-center avitar-gap-2">
                          <button
                            type="button"
                            class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--secondary"
                            {{on "click" (fn this.openPreviewModal template)}}
                            title="Preview Template"
                          >
                            <i class="fas fa-eye"></i>
                          </button>

                          <button
                            type="button"
                            class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--primary"
                            {{on "click" (fn this.openEditModal template)}}
                            title="Edit Template"
                          >
                            <i class="fas fa-edit"></i>
                          </button>

                          <button
                            type="button"
                            class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--warning"
                            {{on "click" (fn this.resetToDefault template)}}
                            title="Reset to Default"
                          >
                            <i class="fas fa-undo"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  {{/each}}
                </tbody>
              </table>
            </div>
          {{else}}
            <div class="avitar-empty-state avitar-py-8">
              <i class="fas fa-envelope fa-3x avitar-text-muted avitar-mb-4"></i>
              <h3 class="avitar-text-lg avitar-font-semibold avitar-mb-2">
                No Email Templates Found
              </h3>
              <p class="avitar-text-muted avitar-mb-4">
                {{#if this.searchText}}
                  No templates match your search criteria
                {{else}}
                  No templates available for this municipality
                {{/if}}
              </p>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </main>
</div>

{{! Edit Template Modal }}
{{#if this.showEditModal}}
  <Shared::EmailTemplateEditor
    @template={{this.selectedTemplate}}
    @onSave={{this.saveTemplate}}
    @onCancel={{this.closeEditModal}}
    @isLoading={{this.isLoading}}
  />
{{/if}}

{{! Preview Modal }}
{{#if this.showPreviewModal}}
  <Shared::EmailPreview
    @template={{this.selectedTemplate}}
    @onClose={{this.closePreviewModal}}
  />
{{/if}}
