{{!-- System Settings --}}
<div class="avitar-content" style="padding: var(--spacing-6); background: var(--color-gray-50);">
  <div class="avitar-card avitar-mb-6">
    <div class="avitar-card__header">
      <h1 class="avitar-card__title">System Settings</h1>
      <div class="avitar-card__subtitle">Configure system preferences and integrations</div>
    </div>
    <div class="avitar-card__body">
      <p class="avitar-text-muted">Configure system-wide settings, API integrations, and technical preferences.</p>
    </div>
  </div>

  {{!-- PID Display Formatting --}}
  <div class="avitar-card">
    <div class="avitar-card__header avitar-card__header--colored">
      <div class="avitar-flex avitar-justify-between avitar-items-center">
        <div>
          <h2 class="avitar-card__title">PID Display Formatting</h2>
          <div class="avitar-card__subtitle">Configure how Property IDs are displayed to users</div>
        </div>
        <div class="avitar-flex avitar-items-center avitar-gap-2">
          <span class="avitar-badge avitar-badge--primary">Configured</span>
          <i class="fas fa-format avitar-text-primary"></i>
        </div>
      </div>
    </div>
    <div class="avitar-card__body">
      <div class="avitar-grid avitar-grid--cols-1 avitar-gap-4">
        {{!-- Current Configuration --}}
        <div class="avitar-p-4 avitar-bg-primary-pale avitar-rounded">
          <h3 class="avitar-text-base avitar-font-semibold avitar-text-gray-900 avitar-mb-1">
            Current PID Format
          </h3>
          <div class="avitar-text-sm avitar-text-muted avitar-mb-3">
            18-digit raw PID is formatted as: Map ({{this.mapDigits}})-Lot ({{this.lotDigits}})-Sub ({{this.subDigits}})
          </div>
          <div class="avitar-bg-white avitar-p-3 avitar-rounded avitar-font-mono avitar-border">
            <div class="avitar-text-sm avitar-text-gray-700 avitar-mb-1">
              Raw PID: <span class="avitar-font-bold">010010010000000000</span>
            </div>
            <div class="avitar-text-sm avitar-text-primary">
              Displayed: <span class="avitar-font-bold avitar-text-lg">{{this.currentFormatPreview}}</span>
            </div>
          </div>
        </div>

        {{!-- Format Configuration --}}
        <div class="avitar-grid avitar-grid--cols-2 avitar-gap-4">
          <div class="avitar-card avitar-card--flat">
            <div class="avitar-card__body">
              <h4 class="avitar-font-semibold avitar-mb-3">
                <i class="fas fa-ruler avitar-text-info avitar-mr-2"></i>
                Digit Allocation
              </h4>
              <div class="avitar-space-y-3">
                <div class="avitar-flex avitar-justify-between avitar-items-center">
                  <label class="avitar-text-sm avitar-font-medium">Map Digits:</label>
                  <select class="avitar-select avitar-select--sm" style="width: 80px;" {{on "change" this.updateMapDigits}}>
                    {{#each this.digitOptions as |digit|}}
                      <option value={{digit}} selected={{eq this.mapDigits digit}}>{{digit}}</option>
                    {{/each}}
                  </select>
                </div>
                <div class="avitar-flex avitar-justify-between avitar-items-center">
                  <label class="avitar-text-sm avitar-font-medium">Lot Digits:</label>
                  <select class="avitar-select avitar-select--sm" style="width: 80px;" {{on "change" this.updateLotDigits}}>
                    {{#each this.digitOptions as |digit|}}
                      <option value={{digit}} selected={{eq this.lotDigits digit}}>{{digit}}</option>
                    {{/each}}
                  </select>
                </div>
                <div class="avitar-flex avitar-justify-between avitar-items-center">
                  <label class="avitar-text-sm avitar-font-medium">Sub Digits:</label>
                  <select class="avitar-select avitar-select--sm" style="width: 80px;" {{on "change" this.updateSubDigits}}>
                    {{#each this.digitOptions as |digit|}}
                      <option value={{digit}} selected={{eq this.subDigits digit}}>{{digit}}</option>
                    {{/each}}
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="avitar-card avitar-card--flat">
            <div class="avitar-card__body">
              <h4 class="avitar-font-semibold avitar-mb-3">
                <i class="fas fa-eye avitar-text-warning avitar-mr-2"></i>
                Display Options
              </h4>
              <div class="avitar-space-y-3">
                <div>
                  <label class="avitar-text-sm avitar-font-medium avitar-mb-2 avitar-block">Separator:</label>
                  <div class="avitar-flex avitar-gap-2">
                    <label class="avitar-radio">
                      <input type="radio" name="separator" value="-" checked={{eq this.separator "-"}} {{on "change" this.updateSeparator}}>
                      <span>Dash (-)</span>
                    </label>
                    <label class="avitar-radio">
                      <input type="radio" name="separator" value="." checked={{eq this.separator "."}} {{on "change" this.updateSeparator}}>
                      <span>Dot (.)</span>
                    </label>
                  </div>
                </div>
                <div>
                  <label class="avitar-checkbox">
                    <input type="checkbox" checked={{this.removeLeadingZeros}} {{on "change" this.toggleRemoveLeadingZeros}}>
                    <span>Remove leading zeros</span>
                  </label>
                </div>
                <div>
                  <label class="avitar-checkbox">
                    <input type="checkbox" checked={{this.showSubOnlyWhenPresent}} {{on "change" this.toggleShowSubOnlyWhenPresent}}>
                    <span>Show sub-lot only when present</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        {{!-- Format Examples --}}
        <div class="avitar-border-t avitar-pt-4">
          <h4 class="avitar-font-semibold avitar-mb-3">
            <i class="fas fa-list avitar-text-success avitar-mr-2"></i>
            Format Examples (Live Preview)
          </h4>
          <div class="avitar-grid avitar-grid--cols-3 avitar-gap-3">
            {{#each this.previewExamples as |example|}}
              <div class="avitar-bg-gray-50 avitar-p-3 avitar-rounded avitar-text-center">
                <div class="avitar-text-xs avitar-text-muted avitar-mb-1">Raw: {{example.raw}}</div>
                <div class="avitar-font-mono avitar-font-bold">{{example.formatted}}</div>
              </div>
            {{/each}}
          </div>
        </div>

        {{!-- Administrative Controls --}}
        <div class="avitar-border-t avitar-pt-4">
          <h4 class="avitar-font-semibold avitar-mb-3">
            <i class="fas fa-cog avitar-text-primary avitar-mr-2"></i>
            Configuration Actions
          </h4>
          <div class="avitar-flex avitar-gap-3 avitar-flex-wrap">
            <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.saveFormatSettings}} disabled={{this.isSaving}}>
              {{#if this.isSaving}}
                <i class="fas fa-spinner fa-spin avitar-mr-2"></i>
                Saving...
              {{else}}
                <i class="fas fa-save avitar-mr-2"></i>
                Save Format Settings
              {{/if}}
            </button>
            <button type="button" class="avitar-btn avitar-btn--outline avitar-btn--secondary" {{on "click" this.resetToDefault}} disabled={{this.isSaving}}>
              <i class="fas fa-undo avitar-mr-2"></i>
              Reset to Default
            </button>
          </div>
          {{#unless this.isValidConfiguration}}
            <div class="avitar-alert avitar-alert--error avitar-mt-3">
              <i class="fas fa-exclamation-circle"></i>
              <strong>Invalid Configuration:</strong> Total digits ({{this.totalDigits}}) exceeds maximum of 18.
            </div>
          {{/unless}}
        </div>

        {{!-- Information Notice --}}
        <div class="avitar-alert avitar-alert--info">
          <i class="fas fa-info-circle"></i>
          <div>
            <strong>Display Formatting:</strong>
            This controls how the 18-digit Property ID numbers are displayed throughout the system. Changes will apply to all property listings, reports, and user interfaces.
          </div>
        </div>
      </div>
    </div>
  </div>

  {{!-- Local Data Management --}}
  <div class="avitar-card avitar-mt-6">
    <div class="avitar-card__header avitar-card__header--colored" style="background-color: var(--color-warning-pale);">
      <div class="avitar-flex avitar-justify-between avitar-items-center">
        <div>
          <h2 class="avitar-card__title">Local Data Management</h2>
          <div class="avitar-card__subtitle">Clear cached data for this municipality and force resynchronization</div>
        </div>
        <div class="avitar-flex avitar-items-center avitar-gap-2">
          <i class="fas fa-database avitar-text-warning"></i>
        </div>
      </div>
    </div>
    <div class="avitar-card__body">
      <div class="avitar-space-y-4">
        <div class="avitar-alert avitar-alert--warning">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>Warning:</strong>
            This will clear all locally cached data for the current municipality, including properties, assessments, sketches, and offline changes. The application will reload and resynchronize all data from the server. Your login session and user preferences will be preserved. Use this if you're experiencing data inconsistencies or sync issues.
          </div>
        </div>

        <div class="avitar-bg-gray-50 avitar-p-4 avitar-rounded">
          <h4 class="avitar-font-semibold avitar-mb-2 avitar-text-sm">
            <i class="fas fa-info-circle avitar-text-info avitar-mr-2"></i>
            What will be cleared:
          </h4>
          <ul class="avitar-text-sm avitar-text-muted avitar-space-y-1" style="list-style: disc; padding-left: 1.5rem;">
            <li>IndexedDB - property and assessment data for this municipality</li>
            <li>Municipality-specific cache keys in local storage</li>
            <li>Sync queue - pending offline changes (will be lost)</li>
            <li>Property navigation and view state</li>
          </ul>
        </div>

        <div class="avitar-bg-success-pale avitar-p-4 avitar-rounded avitar-mt-3">
          <h4 class="avitar-font-semibold avitar-mb-2 avitar-text-sm avitar-text-success">
            <i class="fas fa-shield-alt avitar-text-success avitar-mr-2"></i>
            What will be preserved:
          </h4>
          <ul class="avitar-text-sm avitar-text-gray-700 avitar-space-y-1" style="list-style: disc; padding-left: 1.5rem;">
            <li>Login session and authentication tokens</li>
            <li>User preferences and settings</li>
            <li>Data for other municipalities (if applicable)</li>
          </ul>
        </div>

        <div class="avitar-border-t avitar-pt-4">
          <button
            type="button"
            class="avitar-btn avitar-btn--danger"
            {{on "click" this.clearLocalData}}
            disabled={{this.isClearing}}
          >
            {{#if this.isClearing}}
              <i class="fas fa-spinner fa-spin avitar-mr-2"></i>
              Clearing data...
            {{else}}
              <i class="fas fa-trash-alt avitar-mr-2"></i>
              Clear Municipality Data & Resync
            {{/if}}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>