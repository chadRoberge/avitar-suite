{{#if @isOpen}}
{{!-- Full Page Modal Overlay --}}
{{!-- template-lint-disable no-invalid-interactive --}}
<div class="property-record-modal-overlay" {{on "click" this.closeModal}}>
  <div class="property-record-modal owner-management-modal" {{on "click" this.stopPropagation}}>
    {{!-- Modal Header --}}
    <div class="property-record-modal__header">
      <div class="property-record-modal__title">
        <h2>Property Owners</h2>
        <p>{{@property.pid_formatted}} - {{@property.location.address}}</p>
      </div>
      <div class="property-record-modal__actions">
        <button type="button" class="avitar-button avitar-button--sm avitar-button--primary" {{on "click" this.addOwner}} title="Add New Owner">
          <i class="fas fa-plus"></i>
          Add Owner
        </button>
        <button type="button" class="avitar-button avitar-button--sm avitar-button--outline" {{on "click" this.closeModal}} title="Close Modal">
          <i class="fas fa-times"></i>
          Close
        </button>
      </div>
    </div>

    {{!-- Modal Content --}}
    <div class="property-record-modal__content">
      {{#if this.isLoading}}
      <div class="property-record-modal__loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading owner data...</p>
      </div>
      {{else}}
      
      {{!-- Primary Owner Section --}}
      <div class="avitar-mb-6">
        <div class="avitar-flex avitar-justify-between avitar-items-center avitar-mb-4">
          <h3 class="avitar-text-lg avitar-font-semibold">Primary Owner</h3>
          <button type="button" class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--primary" {{on "click" this.editPrimaryOwner}}>
            <i class="fas fa-edit avitar-mr-1"></i>
            Edit
          </button>
        </div>
        <div class="avitar-card">
          <div class="avitar-card__body">
            {{#if this.hasNewOwnerStructure}}
              <div class="avitar-flex avitar-justify-between avitar-items-start">
                <div class="avitar-flex-1">
                  <h4 class="avitar-text-base avitar-font-medium avitar-mb-2">{{@property.owners.primary.primary_name}}</h4>
                  <p class="avitar-text-sm avitar-text-muted avitar-mb-2">
                    {{@property.owners.primary.mailing_street}}<br>
                    {{@property.owners.primary.mailing_city}}, {{@property.owners.primary.mailing_state}} {{@property.owners.primary.mailing_zipcode}}
                  </p>
                  {{#if @property.owners.primary.ownership_percentage}}
                  <p class="avitar-text-sm">
                    <strong>Ownership:</strong> {{@property.owners.primary.ownership_percentage}}%
                  </p>
                  {{/if}}
                </div>
                <div class="avitar-ml-4">
                  <span class="avitar-badge avitar-badge--primary">Primary</span>
                </div>
              </div>
            {{else}}
              {{!-- Legacy owner data display --}}
              <div class="avitar-flex avitar-justify-between avitar-items-start">
                <div class="avitar-flex-1">
                  <h4 class="avitar-text-base avitar-font-medium avitar-mb-2">{{@property.owner.primary_name}}</h4>
                  {{#if @property.owner.mailing_address}}
                  <p class="avitar-text-sm avitar-text-muted avitar-mb-2">{{@property.owner.mailing_address}}</p>
                  {{/if}}
                </div>
                <div class="avitar-ml-4">
                  <span class="avitar-badge avitar-badge--primary">Primary</span>
                  <span class="avitar-badge avitar-badge--warning avitar-ml-2">Legacy</span>
                </div>
              </div>
            {{/if}}
          </div>
        </div>
      </div>

      {{!-- Additional Owners Section --}}
      {{#if @property.owners.additional_owners.length}}
      <div class="avitar-mb-6">
        <h3 class="avitar-text-lg avitar-font-semibold avitar-mb-4">Additional Owners & Recipients</h3>
        {{#each @property.owners.additional_owners as |owner|}}
        <div class="avitar-card avitar-mb-4">
          <div class="avitar-card__body">
            <div class="avitar-flex avitar-justify-between avitar-items-start">
              <div class="avitar-flex-1">
                <h4 class="avitar-text-base avitar-font-medium avitar-mb-2">{{owner.owner_name}}</h4>
                {{#if owner.mailing_address}}
                <p class="avitar-text-sm avitar-text-muted avitar-mb-2">{{owner.mailing_address}}</p>
                {{/if}}
                {{#if owner.ownership_percentage}}
                <p class="avitar-text-sm avitar-mb-3">
                  <strong>Ownership:</strong> {{owner.ownership_percentage}}%
                </p>
                {{/if}}
                <div class="avitar-flex avitar-gap-2 avitar-mb-3">
                  {{#if owner.additional_owner}}
                    <span class="avitar-badge avitar-badge--secondary">Owner</span>
                  {{/if}}
                  {{#if owner.mail_to}}
                    <span class="avitar-badge avitar-badge--info">Mail To</span>
                  {{/if}}
                  {{#if owner.bill_copy}}
                    <span class="avitar-badge avitar-badge--warning">Bill Copy</span>
                  {{/if}}
                </div>
              </div>
              <div class="avitar-flex avitar-gap-2 avitar-ml-4">
                <button type="button" class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--primary" {{on "click" (fn this.editOwner owner false)}}>
                  <i class="fas fa-edit"></i>
                </button>
                <button type="button" class="avitar-btn avitar-btn--sm avitar-btn--ghost avitar-btn--danger" {{on "click" (fn this.removeOwner owner)}}>
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        {{/each}}
      </div>
      {{/if}}

      {{!-- No Additional Owners Message --}}
      {{#unless @property.owners.additional_owners.length}}
      <div class="avitar-text-center avitar-py-8">
        <i class="fas fa-users avitar-text-4xl avitar-text-muted avitar-mb-4"></i>
        <h3 class="avitar-text-lg avitar-font-semibold avitar-mb-2">No Additional Owners</h3>
        <p class="avitar-text-muted avitar-mb-4">This property only has a primary owner. You can add additional owners, mail-to recipients, or bill copy recipients.</p>
        <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.addOwner}}>
          <i class="fas fa-plus avitar-mr-2"></i>
          Add Owner
        </button>
      </div>
      {{/unless}}

      {{/if}}
    </div>
  </div>
</div>

{{!-- Owner Edit Modal --}}
{{#if this.showOwnerEditModal}}
  <Assessing::OwnerEditModal
    @isOpen={{this.showOwnerEditModal}}
    @owner={{this.editingOwner}}
    @property={{@property}}
    @isPrimary={{this.editingIsPrimary}}
    @onClose={{this.closeOwnerEditModal}}
    @onSave={{this.handleOwnerSave}}
  />
{{/if}}

{{!-- template-lint-enable no-invalid-interactive --}}
{{/if}}