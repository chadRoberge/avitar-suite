{{#if @isOpen}}
{{!-- Full Page Modal Overlay --}}
{{!-- template-lint-disable no-invalid-interactive --}}
<div class="property-record-modal-overlay" {{on "click" this.closeModal}}>
  <div class="property-record-modal owner-edit-modal" {{on "click" this.stopPropagation}}>
    {{!-- Modal Header --}}
    <div class="property-record-modal__header">
      <div class="property-record-modal__title">
        <h2>{{if @owner "Edit" "Add"}} {{if @isPrimary "Primary Owner" "Owner/Recipient"}}</h2>
        <p>{{@property.pid_formatted}} - {{@property.location.address}}</p>
      </div>
      <div class="property-record-modal__actions">
        <button type="button" class="avitar-button avitar-button--sm avitar-button--primary" {{on "click" this.saveOwner}} disabled={{this.isSaving}}>
          <i class="fas {{if this.isSaving 'fa-spinner fa-spin' 'fa-save'}}"></i>
          {{if this.isSaving "Saving..." "Save"}}
        </button>
        <button type="button" class="avitar-button avitar-button--sm avitar-button--outline" {{on "click" this.closeModal}} title="Cancel">
          <i class="fas fa-times"></i>
          Cancel
        </button>
      </div>
    </div>

    {{!-- Modal Content --}}
    <div class="property-record-modal__content">
      <form {{on "submit" this.saveOwner}}>
        {{!-- Owner Search/Select Section --}}
        <div class="avitar-mb-6">
          <h3 class="avitar-text-lg avitar-font-semibold avitar-mb-4">Owner Information</h3>
          
          {{#if this.showOwnerSearch}}
          <div class="avitar-mb-4">
            <label for="owner-search" class="avitar-label">Search Existing Owners</label>
            <div class="avitar-flex avitar-gap-2">
              <input
                type="text"
                id="owner-search"
                class="avitar-input avitar-flex-1"
                placeholder="Type to search for existing owners..."
                value={{this.searchTerm}}
                {{on "input" this.updateSearchTerm}}
              />
              <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.searchOwners}}>
                <i class="fas fa-search"></i>
              </button>
            </div>
            {{#if this.searchResults.length}}
            <div class="avitar-mt-2 avitar-border avitar-rounded avitar-max-h-48 avitar-overflow-y-auto">
              {{#each this.searchResults as |result|}}
              <div class="avitar-p-3 avitar-border-b avitar-cursor-pointer hover:avitar-bg-gray-50" {{on "click" (fn this.selectExistingOwner result)}}>
                <div class="avitar-font-medium">{{result.display_name}}</div>
                {{#if result.business_name}}
                <div class="avitar-text-sm avitar-text-muted">{{result.business_name}}</div>
                {{/if}}
                <div class="avitar-text-sm avitar-text-muted">{{result.mailing_address}}</div>
              </div>
              {{/each}}
            </div>
            {{/if}}
          </div>
          
          <div class="avitar-text-center avitar-my-4">
            <span class="avitar-text-muted">OR</span>
          </div>
          {{/if}}

          {{!-- Create New Owner --}}
          <div class="form-group">
            <button type="button" class="avitar-btn avitar-btn--ghost avitar-btn--secondary" {{on "click" this.toggleCreateNew}}>
              <i class="fas {{if this.showCreateNew 'fa-minus' 'fa-plus'}}"></i>
              {{if this.showCreateNew "Cancel New Owner" "Create New Owner"}}
            </button>
          </div>

          {{#if this.showCreateNew}}
          <div class="create-owner-form">
            <div class="form-row">
              <div class="form-group">
                <label for="owner-type">Owner Type</label>
                <select id="owner-type" class="avitar-select" value={{this.ownerType}} {{on "change" this.updateOwnerType}}>
                  <option value="individual">Individual</option>
                  <option value="business">Business</option>
                  <option value="trust">Trust</option>
                  <option value="estate">Estate</option>
                </select>
              </div>
            </div>

            {{#if (eq this.ownerType "individual")}}
            <div class="form-row">
              <div class="form-group">
                <label for="first-name">First Name *</label>
                <input type="text" id="first-name" class="avitar-input" value={{this.firstName}} {{on "input" this.updateFirstName}} required>
              </div>
              <div class="form-group">
                <label for="last-name">Last Name *</label>
                <input type="text" id="last-name" class="avitar-input" value={{this.lastName}} {{on "input" this.updateLastName}} required>
              </div>
            </div>
            {{else}}
            <div class="form-group">
              <label for="business-name">{{capitalize this.ownerType}} Name *</label>
              <input type="text" id="business-name" class="avitar-input" value={{this.businessName}} {{on "input" this.updateBusinessName}} required>
            </div>
            {{/if}}

            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" class="avitar-input" value={{this.email}} {{on "input" this.updateEmail}}>
            </div>

            <div class="form-group">
              <label for="phone">Phone</label>
              <input type="tel" id="phone" class="avitar-input" value={{this.phone}} {{on "input" this.updatePhone}}>
            </div>

            {{!-- Mailing Address --}}
            <h4>Mailing Address</h4>
            <div class="form-group">
              <label for="street">Street Address *</label>
              <input type="text" id="street" class="avitar-input" value={{this.street}} {{on "input" this.updateStreet}} required>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="city">City *</label>
                <input type="text" id="city" class="avitar-input" value={{this.city}} {{on "input" this.updateCity}} required>
              </div>
              <div class="form-group">
                <label for="state">State *</label>
                <input type="text" id="state" class="avitar-input" value={{this.state}} {{on "input" this.updateState}} required>
              </div>
              <div class="form-group">
                <label for="zip">ZIP Code *</label>
                <input type="text" id="zip" class="avitar-input" value={{this.zipCode}} {{on "input" this.updateZipCode}} required>
              </div>
            </div>
          </div>
          {{/if}}
        </div>

        {{!-- Ownership Details Section --}}
        <div class="form-section">
          <h3>Ownership Details</h3>
          
          {{#unless @isPrimary}}
          <div class="form-group">
            <label>Owner Relationship Type</label>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" checked={{this.isAdditionalOwner}} {{on "change" this.toggleAdditionalOwner}}>
                Additional Owner (has ownership stake)
              </label>
              <label class="checkbox-label">
                <input type="checkbox" checked={{this.isMailTo}} {{on "change" this.toggleMailTo}}>
                Mail To (receives correspondence)
              </label>
              <label class="checkbox-label">
                <input type="checkbox" checked={{this.isBillCopy}} {{on "change" this.toggleBillCopy}}>
                Bill Copy (receives tax bill copies)
              </label>
            </div>
          </div>
          {{/unless}}

          {{#if (or @isPrimary this.isAdditionalOwner)}}
          <div class="form-row">
            <div class="form-group">
              <label for="ownership-percentage">Ownership Percentage</label>
              <div class="input-group">
                <input type="number" id="ownership-percentage" class="avitar-input" min="0" max="100" step="0.01" value={{this.ownershipPercentage}} {{on "input" this.updateOwnershipPercentage}}>
                <span class="input-suffix">%</span>
              </div>
            </div>
            <div class="form-group">
              <label for="ownership-type">Ownership Type</label>
              <select id="ownership-type" class="avitar-select" value={{this.ownershipType}} {{on "change" this.updateOwnershipType}}>
                <option value="fee_simple">Fee Simple</option>
                <option value="joint_tenancy">Joint Tenancy</option>
                <option value="tenancy_in_common">Tenancy in Common</option>
                <option value="life_estate">Life Estate</option>
                <option value="trust">Trust</option>
                <option value="leasehold">Leasehold</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          {{#if @isPrimary}}
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" checked={{this.receivesTaxBills}} {{on "change" this.toggleReceivesTaxBills}}>
              Receives Tax Bills
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" checked={{this.receivesNotices}} {{on "change" this.toggleReceivesNotices}}>
              Receives Notices
            </label>
          </div>
          {{/if}}
          {{/if}}

          <div class="form-group">
            <label for="notes">Notes</label>
            <textarea id="notes" class="avitar-textarea" rows="3" value={{this.notes}} {{on "input" this.updateNotes}}></textarea>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{{!-- template-lint-enable no-invalid-interactive --}}
{{/if}}