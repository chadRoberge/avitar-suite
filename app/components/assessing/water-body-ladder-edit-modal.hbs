{{#if @isOpen}}
  {{!-- Trigger ladder tracking --}}
  {{this.ladderTracker}}
  <div class="avitar-modal-overlay avitar-modal-overlay--visible" {{on "click" @onClose}}>
    <div class="avitar-modal avitar-modal--lg" {{on "click" this.stopPropagation}}>
      <div class="avitar-modal__header">
        <h2 class="avitar-modal__title">Edit Water Body Ladder - {{@waterBodyName}}</h2>
        <button type="button" class="avitar-modal__close" {{on "click" @onClose}}>
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="avitar-modal__body">
        <div class="avitar-flex avitar-justify-between avitar-items-center avitar-mb-4">
          <p class="avitar-text-muted">Configure waterfront value tiers for this water body</p>
          <button type="button" class="avitar-btn avitar-btn--primary avitar-btn--sm" {{on "click" this.addTier}}>
            <i class="fas fa-plus avitar-mr-1"></i>
            Add Tier
          </button>
        </div>

        {{#if this.tiers.length}}
          <div class="avitar-table-container">
            <table class="avitar-table avitar-table--compact">
              <thead>
                <tr>
                  <th>Order</th>
                  <th>Frontage</th>
                  <th>Factor</th>
                  <th class="avitar-table__actions-col">Actions</th>
                </tr>
              </thead>
              <tbody>
                {{#each this.tiers as |tier index|}}
                  <tr>
                    <td>
                      <div class="avitar-flex avitar-gap-1">
                        {{#unless (eq index 0)}}
                          <button type="button" class="avitar-btn avitar-btn--secondary avitar-btn--xs" 
                            {{on "click" (fn this.moveTierUp index)}} title="Move Up">
                            <i class="fas fa-arrow-up"></i>
                          </button>
                        {{/unless}}
                        {{#if (not-eq index (subtract this.tiers.length 1))}}
                          <button type="button" class="avitar-btn avitar-btn--secondary avitar-btn--xs" 
                            {{on "click" (fn this.moveTierDown index)}} title="Move Down">
                            <i class="fas fa-arrow-down"></i>
                          </button>
                        {{/if}}
                      </div>
                    </td>
                    <td>
                      <div class="avitar-input-group avitar-input-group--sm">
                        <input
                          type="number"
                          step="1"
                          min="0"
                          max="10000"
                          class="avitar-input avitar-input--sm"
                          value={{get this.inputValues (concat "frontage_" index)}}
                          {{on "input" (fn this.updateTierFrontage index)}}
                          {{on "blur" (fn this.syncTierData index)}}
                          placeholder="100"
                        />
                        <span class="avitar-input-group__addon">ft</span>
                      </div>
                    </td>
                    <td>
                      <div class="avitar-input-group avitar-input-group--sm">
                        <input
                          type="number"
                          min="0"
                          max="1000"
                          class="avitar-input avitar-input--sm"
                          value={{get this.inputValues (concat "value_" index)}}
                          {{on "input" (fn this.updateTierValue index)}}
                          {{on "blur" (fn this.syncTierData index)}}
                          placeholder="100"
                        />
                      </div>
                    </td>
                    <td class="avitar-table__actions">
                      <button type="button" class="avitar-btn avitar-btn--danger avitar-btn--xs" 
                        {{on "click" (fn this.removeTier index)}} title="Remove Tier">
                        <i class="fas fa-times"></i>
                      </button>
                    </td>
                  </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        {{else}}
          <div class="avitar-empty-state avitar-text-center avitar-py-6">
            <i class="fas fa-water avitar-text-3xl avitar-text-muted avitar-mb-3"></i>
            <div class="avitar-font-semibold avitar-mb-2">No Tiers Configured</div>
            <div class="avitar-text-muted avitar-mb-4">Add your first waterfront value tier to get started</div>
            <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.addTier}}>
              <i class="fas fa-plus avitar-mr-2"></i>
              Add First Tier
            </button>
          </div>
        {{/if}}

        {{#if this.tiers.length}}
          <div class="avitar-mt-6">
            <h4 class="avitar-font-semibold avitar-mb-3">Waterfront Factor Curve</h4>
            <LineGraph 
              @data={{this.graphData}}
              @xField="frontage"
              @yField="value"
              @xLabel="Frontage (ft)"
              @yLabel="Factor"
              @lineColor="#3b82f6"
              @title="Waterfront Factor Curve"
            />
          </div>
        {{/if}}

        {{#if this.hasValidationErrors}}
          <div class="avitar-alert avitar-alert--danger avitar-mt-4">
            <div class="avitar-alert__icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="avitar-alert__content">
              <div class="avitar-alert__title">Validation Errors</div>
              <div class="avitar-alert__message">
                <ul>
                  {{#each this.validationErrors as |error|}}
                    <li>{{error}}</li>
                  {{/each}}
                </ul>
              </div>
            </div>
          </div>
        {{/if}}
      </div>

      <div class="avitar-modal__footer">
        <button type="button" class="avitar-btn avitar-btn--secondary" {{on "click" @onClose}}>
          Cancel
        </button>
        <button type="button" class="avitar-btn avitar-btn--primary" {{on "click" this.saveLadder}}>
          Save Water Body Ladder
        </button>
      </div>
    </div>
  </div>
{{/if}}