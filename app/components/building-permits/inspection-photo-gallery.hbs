<div class="avitar-card">
  <div class="avitar-card__header">
    <div class="avitar-flex avitar-justify-between avitar-items-center">
      <h3 class="avitar-card__title">
        <i class="fas fa-camera avitar-mr-2"></i>
        Inspection Photos
        {{#if this.sortedPhotos.length}}
          <span class="avitar-badge avitar-badge--primary avitar-ml-2">
            {{this.sortedPhotos.length}}
          </span>
        {{/if}}
      </h3>
      <button
        type="button"
        class="avitar-btn avitar-btn--sm avitar-btn--primary"
        {{on "click" this.openUploadModal}}
      >
        <i class="fas fa-plus avitar-mr-2"></i>
        Add Photos
      </button>
    </div>
  </div>

  <div class="avitar-card__body">
    {{#if this.sortedPhotos.length}}
      <div class="avitar-grid avitar-grid--2 avitar-gap-4">
        {{#each this.sortedPhotos as |photo|}}
          <div
            class="avitar-card avitar-card--hover avitar-cursor-pointer"
            {{on "click" (fn this.openPhotoModal photo)}}
          >
            {{! Photo Image }}
            <div class="avitar-relative avitar-overflow-hidden" style="height: 250px; background-color: #f3f4f6;">
              {{#if photo.thumbnail}}
                <img
                  src={{photo.thumbnail}}
                  alt={{or photo.caption photo.filename}}
                  class="avitar-w-full avitar-h-full avitar-object-cover"
                  loading="lazy"
                />
              {{else if photo.url}}
                <img
                  src={{photo.url}}
                  alt={{or photo.caption photo.filename}}
                  class="avitar-w-full avitar-h-full avitar-object-cover"
                  loading="lazy"
                />
              {{else}}
                <div class="avitar-flex avitar-items-center avitar-justify-center avitar-h-full">
                  <i class="fas fa-image fa-3x avitar-text-muted"></i>
                </div>
              {{/if}}

              {{! Photo Date Badge }}
              <div class="avitar-absolute avitar-top-2 avitar-right-2">
                <span class="avitar-badge avitar-badge--secondary avitar-badge--sm">
                  {{date-format photo.uploadedAt "MMM DD, YYYY"}}
                </span>
              </div>
            </div>

            {{! Photo Caption/Notes }}
            <div class="avitar-card__body avitar-p-3">
              {{#if photo.caption}}
                <p class="avitar-text-sm avitar-font-medium avitar-mb-2 avitar-line-clamp-2">
                  {{photo.caption}}
                </p>
              {{else}}
                <p class="avitar-text-sm avitar-text-muted avitar-italic avitar-mb-2">
                  No caption
                </p>
              {{/if}}

              <div class="avitar-flex avitar-items-center avitar-gap-2 avitar-text-xs avitar-text-muted">
                <i class="fas fa-clock"></i>
                {{date-format photo.uploadedAt "HH:mm"}}
              </div>
            </div>
          </div>
        {{/each}}
      </div>
    {{else}}
      <div class="avitar-empty-state avitar-py-6">
        <i class="fas fa-camera fa-3x avitar-text-muted avitar-mb-3"></i>
        <h3 class="avitar-mb-2">No Photos</h3>
        <p class="avitar-text-muted avitar-mb-4">
          Add photos to document this inspection.
        </p>
        <button
          type="button"
          class="avitar-btn avitar-btn--primary"
          {{on "click" this.openUploadModal}}
        >
          <i class="fas fa-plus avitar-mr-2"></i>
          Add First Photo
        </button>
      </div>
    {{/if}}
  </div>
</div>

{{! Photo Upload Modal }}
{{#if this.showUploadModal}}
  <div class="avitar-modal-overlay avitar-modal-overlay--visible" {{on "click" this.closeUploadModal}}>
    <div class="avitar-modal avitar-modal--md" {{on "click" this.stopPropagation}}>
      <div class="avitar-modal__header">
        <h2 class="avitar-modal__title">
          <i class="fas fa-upload avitar-mr-2"></i>
          Upload Inspection Photos
        </h2>
        <button type="button" class="avitar-modal__close" {{on "click" this.closeUploadModal}}>
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="avitar-modal__body">
        <p class="avitar-text-muted avitar-mb-4">
          Upload photos documenting this inspection. You can add captions to each photo.
        </p>

        {{! TODO: Integrate with photo upload functionality }}
        <div class="avitar-alert avitar-alert--info">
          <i class="fas fa-info-circle avitar-mr-2"></i>
          Photo upload functionality will be integrated with the inspection photo upload endpoint.
        </div>
      </div>

      <div class="avitar-modal__footer">
        <button
          type="button"
          class="avitar-btn avitar-btn--secondary"
          {{on "click" this.closeUploadModal}}
        >
          Close
        </button>
      </div>
    </div>
  </div>
{{/if}}

{{! Photo Detail Modal }}
{{#if this.showPhotoModal}}
  <div class="avitar-modal-overlay avitar-modal-overlay--visible" {{on "click" this.closePhotoModal}}>
    <div class="avitar-modal avitar-modal--lg" {{on "click" this.stopPropagation}}>
      <div class="avitar-modal__header">
        <h2 class="avitar-modal__title">
          <i class="fas fa-image avitar-mr-2"></i>
          {{or this.selectedPhoto.caption this.selectedPhoto.filename}}
        </h2>
        <button type="button" class="avitar-modal__close" {{on "click" this.closePhotoModal}}>
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="avitar-modal__body">
        {{! Full Size Photo }}
        <div class="avitar-mb-4 avitar-text-center">
          <img
            src={{this.selectedPhoto.url}}
            alt={{or this.selectedPhoto.caption this.selectedPhoto.filename}}
            class="avitar-max-w-full avitar-max-h-96 avitar-mx-auto avitar-rounded"
          />
        </div>

        {{! Photo Details }}
        <div class="avitar-space-y-3">
          {{#if this.selectedPhoto.caption}}
            <div>
              <label class="avitar-label">Caption</label>
              <p class="avitar-text-sm">{{this.selectedPhoto.caption}}</p>
            </div>
          {{/if}}

          <div class="avitar-grid avitar-grid--2 avitar-gap-4">
            <div>
              <label class="avitar-label">Uploaded</label>
              <p class="avitar-text-sm">
                {{date-format this.selectedPhoto.uploadedAt "MMM DD, YYYY HH:mm"}}
              </p>
            </div>

            {{#if this.selectedPhoto.filename}}
              <div>
                <label class="avitar-label">Filename</label>
                <p class="avitar-text-sm avitar-truncate">{{this.selectedPhoto.filename}}</p>
              </div>
            {{/if}}
          </div>
        </div>
      </div>

      <div class="avitar-modal__footer">
        <button
          type="button"
          class="avitar-btn avitar-btn--danger"
          {{on "click" (fn this.deletePhoto this.selectedPhoto)}}
          disabled={{this.isDeleting}}
        >
          {{#if this.isDeleting}}
            <i class="fas fa-spinner fa-spin avitar-mr-2"></i>
            Deleting...
          {{else}}
            <i class="fas fa-trash avitar-mr-2"></i>
            Delete Photo
          {{/if}}
        </button>
        <button
          type="button"
          class="avitar-btn avitar-btn--secondary"
          {{on "click" this.closePhotoModal}}
        >
          Close
        </button>
      </div>
    </div>
  </div>
{{/if}}
